<!doctype html><html lang=en><head><title>[Object Detection] 目標檢測評估指標 (Object Detection Metrics) - Kaka's Blog</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name=renderer content="webkit"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=format-detection content="telephone=no,email=no,adress=no"><meta name=theme-color content="#000000"><meta http-equiv=window-target content="_top"><meta name=description content="目標檢測評估指標 (Object Detection Metrics) Object Detection 需要執行兩個任務: decide whether an object exists in the scene: classification determine the position, the orientation and the shape of the object: localization 在現實場景中，一個場景會包含很多物件類別（如: 車輛、行"><meta name=generator content="Hugo 0.110.0 with theme pure"><title>[Object Detection] 目標檢測評估指標 (Object Detection Metrics) - Kaka's Blog</title><link rel=stylesheet href=https://kaka-lin.github.io/my-blog/css/style.min.c42838cb837ce405361b2d6e3a1e99ddcc6be6d8be2766f2fe32a151d5664f19.css><link rel=stylesheet href=https://kaka-lin.github.io/my-blog/css/custom.css async><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css async><meta property="og:title" content="[Object Detection] 目標檢測評估指標 (Object Detection Metrics)"><meta property="og:description" content="目標檢測評估指標 (Object Detection Metrics) Object Detection 需要執行兩個任務: decide whether an object exists in the scene: classification determine the position, the orientation and the shape of the object: localization 在現實場景中，一個場景會包含很多物件類別（如: 車輛、行"><meta property="og:type" content="article"><meta property="og:url" content="https://kaka-lin.github.io/my-blog/2022/08/object_detection/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-16T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-16T00:00:00+00:00"><meta property="og:see_also" content="https://kaka-lin.github.io/my-blog/2022/09/resize_image/"><meta property="og:see_also" content="https://kaka-lin.github.io/my-blog/2022/09/progress_bar/"><meta property="og:see_also" content="https://kaka-lin.github.io/my-blog/2022/09/custom_training_loop/"><meta property="og:see_also" content="https://kaka-lin.github.io/my-blog/2022/08/introduction/"><meta property="og:see_also" content="https://kaka-lin.github.io/my-blog/2022/08/progress_bar/"><meta property="og:see_also" content="https://kaka-lin.github.io/my-blog/2022/08/datasets_dataloaders/"><meta itemprop=name content="[Object Detection] 目標檢測評估指標 (Object Detection Metrics)"><meta itemprop=description content="目標檢測評估指標 (Object Detection Metrics) Object Detection 需要執行兩個任務: decide whether an object exists in the scene: classification determine the position, the orientation and the shape of the object: localization 在現實場景中，一個場景會包含很多物件類別（如: 車輛、行"><meta itemprop=datePublished content="2022-08-16T00:00:00+00:00"><meta itemprop=dateModified content="2022-08-16T00:00:00+00:00"><meta itemprop=wordCount content="2085"><meta itemprop=keywords content="Object Detection,Metrics,"><meta name=twitter:card content="summary"><meta name=twitter:title content="[Object Detection] 目標檢測評估指標 (Object Detection Metrics)"><meta name=twitter:description content="目標檢測評估指標 (Object Detection Metrics) Object Detection 需要執行兩個任務: decide whether an object exists in the scene: classification determine the position, the orientation and the shape of the object: localization 在現實場景中，一個場景會包含很多物件類別（如: 車輛、行"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body class="main-center theme-black" itemscope itemtype=http://schema.org/WebPage><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=slimContent><div class=navbar-header><div class="profile-block text-center"><a id=avatar href=https://github.com/kaka-lin target=_blank><img class="img-circle img-rotate" src=https://kaka-lin.github.io/my-blog/images/kaka_virtual.jpg width=200 height=200></a><h2 id=name class="hidden-xs hidden-sm">Kaka Lin</h2><h3 id=title class="hidden-xs hidden-sm hidden-md">Software Engineer</h3><small id=location class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i>Taipei, Taiwan</small></div><div class=search id=search-form-wrap><form class="search-form sidebar-form"><div class=input-group><input type=text class="search-form-input form-control" placeholder=Search>
<span class=input-group-btn><button type=submit class="search-form-submit btn btn-flat" onclick=return!1><i class="icon icon-search"></i></button></span></div><div class=ins-search><div class=ins-search-mask></div><div class=ins-search-container><div class=ins-input-wrapper><input type=text class=ins-search-input placeholder="Type something..." x-webkit-speech>
<button type=button class="close ins-close ins-selectable" data-dismiss=modal aria-label=Close><span aria-hidden=true>×</span></button></div><div class=ins-section-wrapper><div class=ins-section-container></div></div></div></div></form></div><button class="navbar-toggle collapsed" type=button data-toggle=collapse data-target=#main-navbar aria-controls=main-navbar aria-expanded=false>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><nav id=main-navbar class="collapse navbar-collapse" itemscope itemtype=http://schema.org/SiteNavigationElement role=navigation><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href=/my-blog/><i class="icon icon-home-fill"></i>
<span class=menu-title>Home</span></a></li><li class="menu-item menu-item-categories"><a href=/my-blog/categories/><i class="icon icon-folder"></i>
<span class=menu-title>Categories</span></a></li><li class="menu-item menu-item-books"><a href=/my-blog/series/><i class="icon icon-book-fill"></i>
<span class=menu-title>Study Notes</span></a></li><li class="menu-item menu-item-tags"><a href=/my-blog/tags/><i class="icon icon-tags"></i>
<span class=menu-title>Tags</span></a></li><li class="menu-item menu-item-about"><a href=/my-blog/about/><i class="icon icon-cup-fill"></i>
<span class=menu-title>About</span></a></li></ul></nav></div></header><aside class=sidebar itemscope itemtype=http://schema.org/WPSideBar><div class=slimContent><div class=widget><h3 class=widget-title>Categories</h3><div class=widget-body><ul class=category-list><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/c++/ class=category-list-link>c++</a><span class=category-list-count>3</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/canbus/ class=category-list-link>canbus</a><span class=category-list-count>2</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/data-science/ class=category-list-link>data-science</a><span class=category-list-count>4</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/data-structure-and-algorithm/ class=category-list-link>data-structure-and-algorithm</a><span class=category-list-count>16</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/database/ class=category-list-link>database</a><span class=category-list-count>4</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/devops/ class=category-list-link>devops</a><span class=category-list-count>2</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/docker/ class=category-list-link>docker</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/go/ class=category-list-link>go</a><span class=category-list-count>8</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/ml/dl/ class=category-list-link>ml/dl</a><span class=category-list-count>9</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/os/ class=category-list-link>os</a><span class=category-list-count>3</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/python/ class=category-list-link>python</a><span class=category-list-count>13</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/qt/ class=category-list-link>qt</a><span class=category-list-count>1</span></li><li class=category-list-item><a href=https://kaka-lin.github.io/my-blog/categories/react/ class=category-list-link>react</a><span class=category-list-count>2</span></li></ul></div></div><div class=widget><h3 class=widget-title>Series</h3><div class=widget-body><ul class=series-list><li class=series-list-item><a href=https://kaka-lin.github.io/my-blog/series/asynchronous-programming/ class=series-list-link>asynchronous-programming</a><span class=series-list-count>7</span></li><li class=series-list-item><a href=https://kaka-lin.github.io/my-blog/series/data-structure-and-algorithm/ class=series-list-link>data-structure-and-algorithm</a><span class=series-list-count>16</span></li><li class=series-list-item><a href=https://kaka-lin.github.io/my-blog/series/go/ class=series-list-link>go</a><span class=series-list-count>7</span></li><li class=series-list-item><a href=https://kaka-lin.github.io/my-blog/series/machine-learning/ class=series-list-link>machine-learning</a><span class=series-list-count>9</span></li><li class=series-list-item><a href=https://kaka-lin.github.io/my-blog/series/python/ class=series-list-link>python</a><span class=series-list-count>13</span></li><li class=series-list-item><a href=https://kaka-lin.github.io/my-blog/series/pytorch/ class=series-list-link>pytorch</a><span class=series-list-count>3</span></li><li class=series-list-item><a href=https://kaka-lin.github.io/my-blog/series/react/ class=series-list-link>react</a><span class=series-list-count>2</span></li><li class=series-list-item><a href=https://kaka-lin.github.io/my-blog/series/tensorflow/ class=series-list-link>tensorflow</a><span class=series-list-count>3</span></li><li class=series-list-item><a href=https://kaka-lin.github.io/my-blog/series/yolo-series/ class=series-list-link>yolo-series</a><span class=series-list-count>1</span></li></ul></div></div><div class=widget><h3 class=widget-title>Tags</h3><div class=widget-body><ul class=tag-list><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/array/ class=tag-list-link>array</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/automatic-differentiation/ class=tag-list-link>automatic-differentiation</a><span class=tag-list-count>3</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/canbus/ class=tag-list-link>canbus</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/ci/cd/ class=tag-list-link>ci/cd</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/classification/ class=tag-list-link>classification</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/concurrency/ class=tag-list-link>concurrency</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/coroutine/ class=tag-list-link>coroutine</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/docker/ class=tag-list-link>docker</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/dp/ class=tag-list-link>dp</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/generator/ class=tag-list-link>generator</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/google-trends/ class=tag-list-link>google-trends</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/hash-table/ class=tag-list-link>hash-table</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/heap/ class=tag-list-link>heap</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/i/o-models/ class=tag-list-link>i/o-models</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/jupyter/ class=tag-list-link>jupyter</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/kvaser/ class=tag-list-link>kvaser</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/letterbox/ class=tag-list-link>letterbox</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/linked-list/ class=tag-list-link>linked-list</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/matplotlib/ class=tag-list-link>matplotlib</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/metrics/ class=tag-list-link>metrics</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/mysql/ class=tag-list-link>mysql</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/object-detection/ class=tag-list-link>object-detection</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/oop/ class=tag-list-link>oop</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/orm/ class=tag-list-link>orm</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/parallelism/ class=tag-list-link>parallelism</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/progressbar/ class=tag-list-link>progressbar</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/socketcan/ class=tag-list-link>socketcan</a><span class=tag-list-count>2</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/sqlalchemy/ class=tag-list-link>sqlalchemy</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/sqlite/ class=tag-list-link>sqlite</a><span class=tag-list-count>1</span></li><li class=tag-list-item><a href=https://kaka-lin.github.io/my-blog/tags/tree/ class=tag-list-link>tree</a><span class=tag-list-count>11</span></li></ul></div></div><div class=widget><h3 class=widget-title>Recent Posts</h3><div class=widget-body><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class=item-inner><p class=item-title><a href=https://kaka-lin.github.io/my-blog/2023/03/socketcan_example/ class=title>[CanBus] Example C code for SocketCAN</a></p><p class=item-date><time datetime="2023-03-27 00:00:00 +0000 UTC" itemprop=datePublished>2023-03-27</time></p></div></li><li><div class=item-inner><p class=item-title><a href=https://kaka-lin.github.io/my-blog/2023/03/kvaser_socketcan/ class=title>[CanBus] SocketCAN Support for Kvaser Devices</a></p><p class=item-date><time datetime="2023-03-23 00:00:00 +0000 UTC" itemprop=datePublished>2023-03-23</time></p></div></li><li><div class=item-inner><p class=item-title><a href=https://kaka-lin.github.io/my-blog/2022/09/red_black_tree_removal/ class=title>[DSA] 紅黑樹 (Red-Black Tree) 介紹 - Part 2: Removal</a></p><p class=item-date><time datetime="2022-09-28 00:00:00 +0000 UTC" itemprop=datePublished>2022-09-28</time></p></div></li><li><div class=item-inner><p class=item-title><a href=https://kaka-lin.github.io/my-blog/2022/09/red_black_tree/ class=title>[DSA] 紅黑樹 (Red-Black Tree) 介紹 - Part 1: Insertion</a></p><p class=item-date><time datetime="2022-09-24 00:00:00 +0000 UTC" itemprop=datePublished>2022-09-24</time></p></div></li><li><div class=item-inner><p class=item-title><a href=https://kaka-lin.github.io/my-blog/2022/09/2_3_4_tree/ class=title>[DSA] 2-3-4 Tree 介紹</a></p><p class=item-date><time datetime="2022-09-22 00:00:00 +0000 UTC" itemprop=datePublished>2022-09-22</time></p></div></li></ul></div></div></div></aside><aside class="sidebar sidebar-toc collapse" id=collapseToc itemscope itemtype=http://schema.org/WPSideBar><div class=slimContent><h4 class=toc-title>Catalogue</h4><nav id=toc class="js-toc toc"></nav></div></aside><main class=main role=main><div class=content><article id=- class="article article-type-" itemscope itemtype=http://schema.org/BlogPosting><div class=article-header><h1 itemprop=name><a class=article-title href=/my-blog/2022/08/object_detection/>[Object Detection] 目標檢測評估指標 (Object Detection Metrics)</a></h1><div class=article-meta><span class=article-date><i class="icon icon-calendar-check"></i>&nbsp;
<a href=https://kaka-lin.github.io/my-blog/2022/08/object_detection/ class=article-date><time datetime="2022-08-16 00:00:00 +0000 UTC" itemprop=datePublished>2022-08-16</time></a></span>
<span class=article-category><i class="icon icon-folder"></i>&nbsp;
<a class=article-category-link href=/my-blog/categories/ml/dl/>ML/DL</a>
</span><span class=article-series><i class="icon icon-book"></i>&nbsp;
<a class=article-series-link href=/my-blog/series/machine-learning/>Machine Learning</a></span>
<span class=article-tag><i class="icon icon-tags"></i>&nbsp;
<a class=article-tag-link href=/my-blog/tags/object-detection/>Object Detection</a>
<a class=article-tag-link href=/my-blog/tags/metrics/>Metrics</a></span>
<span class=post-comment><i class="icon icon-comment"></i>&nbsp;<a href=/my-blog/2022/08/object_detection/#comments class=article-comment-link>Comments</a></span></div></div><div class="article-entry marked-body js-toc-content" itemprop=articleBody><h1 id=目標檢測評估指標-object-detection-metrics>目標檢測評估指標 (Object Detection Metrics)</h1><p>Object Detection 需要執行兩個任務:</p><ol><li>decide whether an object exists in the scene: <code>classification</code></li><li>determine the position, the orientation and the shape of the object: <code>localization</code></li></ol><p>在現實場景中，一個場景會包含很多物件類別（如: 車輛、行人、騎自行車的人、交通標誌），這導致有必要為每個檢測到的對象分配一個置信度(confidence)分數，通常在 0.0 ~ 1.0 之間。</p><p>Based on this score, the detection algorithm can be assessed at <code>various confidence levels</code>, which means that the threshold for accepting or rejecting an object is <code>systematically varied (系統地變化)</code>.</p><p>In order to address these issues, the <code>Average Precision (AP)</code> metric was proposed as a suitable metric for object detection.</p><h2 id=confusion-matrix>Confusion Matrix</h2><ul><li><p>True positive(TP): Patient actually has the illness and the test result was positive.</p></li><li><p>False positive(FP): Patient does not have the illness, but the test was positive nonetheless.</p></li><li><p>False negative(FN): Patient has the illness, but the test was wrongly negative.</p></li><li><p>True negative(TN): Patient does not have the illness and the test correctly returns a negative result.</p><pre><code>In object detection, this would mean that
there is no object present in a scene
and the detector has correctly not returned a detection.
</code></pre><p><img src=images/confusion_matrix.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/confusion_matrix.png alt></p></li></ul><h2 id=precision-and-recall>Precision and Recall</h2><ol><li><p>What is the probability that an object found by the algorithm actually corresponds to a real object?</p><p>-> <code>Precision</code> or <code>Positive Predictive Value" (PPV)</code></p></li><li><p>What is the probability for a real object to be found by the detector?</p><p>-> <code>Recall</code> or <code>True Positive Rate" (TPR)</code> or <code>sensitivity</code>.</p></li></ol><p>理想情況是 Precision 和 Recall 都是 1.0，
但通常會是相反的，提高 Recall 就會降低 Precision，反之亦然。</p><h3 id=precision-準確率>Precision (準確率)</h3><p>當模型預測為特定類別的目標物，有多少是正確的。 (<code>針對預測結果</code>)</p><pre><code>Precision = TP / (TP + FP)
</code></pre><h3 id=recall-召回率>Recall (召回率)</h3><p>實際為目標物也確實被預測為目標物的比例。(<code>針對原來的樣本</code>)</p><pre><code>Recall = TP / (TP + FN)
</code></pre><h3 id=example-1>Example 1:</h3><p>假設有一個 detector, TP=80, FP=2, FN=6</p><pre><code>P = 80 / (80 + 2) = 0.9756
R = 80 / (80 + 6) = 0.9302
</code></pre><p>當我們<code>降低 classification threshold</code> 時，confidence 分數較低的物件將會被檢測到，則 <code>FN 下降，FP 上升</code>，導致 <code>Recall 上升，Precision 下降</code>，如: TP=80, FP=6, FN=2</p><pre><code>P = 80 / (80 + 6) = 0.9302
R = 80 / (80 + 2) = 0.9756
</code></pre><h3 id=example-2>Example 2:</h3><p><img src=images/precision_recall_1.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/precision_recall_1.png alt></p><p>如上圖所示，圖片裡有4台汽車，但模型偵測出5台汽車</p><pre><code>TP = 4
FP = 1
FN = 0

Precision = TP / (TP + FP) = 4 / 5
Recall = TP / (TP + FN) = 4 / 4 = 1
</code></pre><h2 id=f1-score-f1-mesure>F1-score (F1-Mesure)</h2><p>他是<code>F-score</code>的一個特例，當<code>beta=1</code>時就是<code>F1-score</code>。</p><p><code>F1-score</code>最理想的數值是<code>趨近於1</code>，就是讓precision和recall都有很高的值。</p><pre><code>F1-score = 2 * ((Precision * Recall) / (Precision + Recall))
</code></pre><p>$$ F1 = 2 * \frac{Precision * Recall}{Precision + Recall}$$</p><p>假設兩者皆為1，則<code>F1-score = 1 (100%)</code>，代表該演算法有著最佳的精確度</p><h2 id=intersection-over-union-iou>Intersection over Union (IoU)</h2><p><code>IoU</code> 簡單來說就就是評估預測的 <code>bounding box</code> 與 <code>ground truth box</code> 有多重疊(多像)，如下所示:</p><p><img src=images/iou.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/iou.png alt></p><h3 id=iou-and-precision-and-recall>IoU and Precision and Recall</h3><p>在 Onject Detection 的任務中，<code>我們可以透過 IoU 來計算 Precision 與 Recall，根據 IoU Threshold 判斷</code>，一般情況下，<em>如果 bounding box 被預測為確實有目標物存在，且 IoU 大於所設之threshold，我們就認定此 boundind box 為 True Positive (TP)，反之為 Flase Positive (FP)。</em></p><p>For Example，假設 <code>IoU Threshold: 0.5</code></p><ol><li>Object IoU 0.7 -> TP</li><li>Object IoU 0.3 -> FP</li></ol><p><img src=images/iou_tp_fp_1.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/iou_tp_fp_1.png alt></p><p>現在針對 <code>IoU = 0.3</code> 的情況來看</p><ol><li>IoU Threshold 0.5 -> FP</li><li>IoU Threshold 0.2 -> TP</li></ol><p><img src=images/iou_tp_fp_2.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/iou_tp_fp_2.png alt></p><p>所以 <code>IoU Threshold</code> 的選擇很重要！</p><pre><code>有的設置 IoU Threshold 0.5，
也有的設置 IoU Threshold 0.7
</code></pre><h2 id=precision-recall-curve>Precision-Recall Curve</h2><p>As mentioned previously, there is an inverse relationship between precision and recall, which is dependent on the threshold we choose for object detection. Let us take a look at the following figure, which shows the precision-recall curves of various object detection algorithms (each color represents a different algorithm):</p><p><img src=images/precision_recall_curves.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/precision_recall_curves.png alt>
Precision-Recall curves for 5 detectors</p><p>The curves are generated by varying the detection threshold from 0.0 to 1.0 and by computing precision and recall for each setting. Based on this metric, the solid blue curve shows the best performance, as the precision (i.e. the likelihood that a detection actually corresponds to a real object) drops the least for increasing recall values. Ideally, precision would stay at 1.0 until a recall of 1.0 has been reached. <code>Thus, another way of looking at these curves would be to compare detectors based on the area under the curve: Thus, the larger the integral of the precision-recall curve, the higher the detector performance.</code> Based on the precision-recall curve, engineers can make an informed decision on the detector threshold setting they want to choose by considering the demands of their application in terms of precision and recall.</p><h2 id=average-precision-ap>Average Precision (AP)</h2><p>我們先來看看 Average Precision 的定義：</p><p>The idea of the <code>average precision (AP)</code> metric is to <code>compact the information within the precision-recall curve into a single number</code>, which can be used to easily compare algorithms with each other. This goal is achieved by summing the precision values for different (=11) equally spaced recall values:</p><p>$$ AP=\frac{1}{11} \sum_{Recall_i} Precision(Recall_i)$$</p><p><img src=images/average_precision.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/average_precision.png alt></p><p>Note that in practice, varying the threshold level in equally spaced increments does not correspond to equally spaced increases in recall. The AP score for an algorithm varies between 0.0 and 1.0 with the latter being a perfect result.</p><p>所謂的 <code>Average Precision (AP) 就是計算 Precision-Recall 曲線下的面積</code>。且由於 Precision 與 Recall 都是介於 0~1 之間的數值，因此 <code>AP 也是介於 0~1 之間的數值</code>。</p><h3 id=example-of-ap>Example of AP</h3><p>接下來讓我看一下例子 [2&3]:</p><p>假設偵測目標為車子且總共有8台，Ground Truth 與模型給出的預測如下所示:</p><p><img src=images/ap_1.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_1.png alt></p><ol><li><p>將結果<code>按照 Confidence 大小降序排序</code>，且 <code>IoU Threshold 為 0.5</code>，如下:</p><p><img src=images/ap_2.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_2.png alt></p></li><li><p><code>針對每個預測，決定其是 TP or FP，並且計算 Precision 和 Recall</code>，如下:</p><pre><code>Rank 1:
  Precision = TP / (TP+FP) = 1/1 = 1
  Recall = TP / total P = 1/8 = 0.125
Rank 2:
  Precision = 2/2 = 1
  Recall = 2/8 = 0.25
Rank 3:
  Precision = 3/3 = 1
  Recall = 3/8 = 0.375
Rank 4:
  Precision = 3/4 = 0.75
  Recall = 3/8 = 0.375
Rank 5:
  Precision = 4/5 = 0.8
  Recall = 4/8 = 0.5
Rank 6:
  Precision = 5/6 = 0.833
  Recall = 5/8 = 0.625
Rank 7:
  Precision = 5/7 = 0.714
  Recall = 5/8 = 0.625
Rank 8:
 Precision = 5/8 = 0.625
 Recall = 5/8 = 0.625
Rank 9:
  Precision = 5/9 = 0.556
  Recall = 5/8 = 0.625
Rank 10:
  Precision = 5/10 = 0.5
  Recall = 5/8 = 0.625
</code></pre><p>畫出 <code>Precision-Recall</code> curve, 如下:</p><p><img src=images/ap_3.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_3.png alt></p><p>可以發現到:</p><ul><li>Recall 會隨著計算的 case 越多呈現越來越大的趨勢</li><li>Precision 則不一定，會根據 TP or FP 而一直跳動</li></ul></li><li><p><code>拉平曲線 (smooth the curve)</code></p><p><img src=images/ap_4.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_4.png alt></p><p>Graphically, at each recall level, we replace each precision value with the maximum precision value to the right of that recall level.</p><p><img src=images/ap_5.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_5.png alt></p></li></ol><h3 id=interpolated-ap-pascal-voc-challenge-before-2010>Interpolated AP (PASCAL VOC Challenge before 2010)</h3><p>PASCAL VOC is a popular dataset for object detection. For the PASCAL VOC challenge, a prediction is positive if IoU ≥ 0.5. Also, if multiple detections of the same object are detected, it counts the first one as a positive while the rest as negatives.</p><p>Pascal VOC2010之前將 Recall 分成 11 個點，分別為 <code>{0, 0.1, , …, 0.9, 1.0}</code>，並找出這幾個點的最大 Precision 作平均計算。</p><p><img src=images/ap_6.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_6.png alt></p><p><img src=images/ap_4.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_4.png alt></p><pre><code>AP = (1+1+1+1+0.833+0.833+0.833+0+0+0+0) / 11 = 0.591
</code></pre><h3 id=auc-area-under-curve--ap-pascal-voc-challenge-after-2010>AUC (Area under curve ) AP (PASCAL VOC Challenge after 2010)</h3><p>Instead of sampling 11 points, we sample p(rᵢ) whenever it drops and computes AP as the sum of the rectangular blocks.</p><p><img src=images/ap_7.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_7.png alt></p><p>This definition is called the <code>Area Under Curve (AUC)</code>.</p><p><img src=images/ap_4.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_4.png alt></p><p><img src=images/ap_8.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_8.png alt></p><pre><code>AP = 1*0.375 + 0.833*(0.625-0.375) = 0.583
</code></pre><p>As shown below, as the interpolated points do not cover where the precision drops, both methods will diverge.</p><p><img src=images/ap_9.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/ap_9.png alt></p><h2 id=mean-average-precision-map>Mean Average Precision (mAP)</h2><p><code>Mean Average Precision (mAP)</code>有兩種:</p><ul><li>考慮各種不同 IoU 值</li><li>除了 IoU 值還考慮各種對象類別</li></ul><h3 id=based-on-only-iou>Based on only IoU</h3><p>因為改變 IoU 閾值會影響無論是 Precision 或是 Recall，此時 mAP 就是計算個 IoU 閾值下的 AP 分數，然後根據這些值計算平均值。如下圖所示:</p><p><img src=images/precision_recall_curves_for_varying_IoU_thresholds.png alt>
<img src=/my-blog/images/ml/metrics/object_detection/precision_recall_curves_for_varying_IoU_thresholds.png alt>
Precision-Recall curves for varying IoU thresholds</p><p>但有些 dataset的 mAP 跟 AP 是一樣的，像 COCO dataset，所以須去了解各自 dataset 的 AP 與 mAP 定義。</p><p><em>AP is averaged over all categories. Traditionally, this is called “mean average precision” (mAP). We make no distinction between AP and mAP (and likewise AR and mAR) and assume the difference is clear from context. <a href=https://cocodataset.org/#detection-eval>COCO Evaluation</a></em></p><pre><code>AP50: IoU threshold 0.5
AP75: IoU threshold 0.75
</code></pre><h2 id=reference>Reference</h2><ol><li><a href=https://towardsdatascience.com/map-mean-average-precision-might-confuse-you-5956f1bfa9e2>mAP (mean Average Precision) might confuse you!</a></li><li><a href=https://medium.com/curiosity-and-exploration/mean-average-precision-map-%E8%A9%95%E4%BC%B0%E7%89%A9%E9%AB%94%E5%81%B5%E6%B8%AC%E6%A8%A1%E5%9E%8B%E5%A5%BD%E5%A3%9E%E7%9A%84%E6%8C%87%E6%A8%99-70a2d2872eb0>mean Average Precision (mAP) — 評估物體偵測模型好壞的指標</a></li><li><a href=https://chih-sheng-huang821.medium.com/%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92%E7%B3%BB%E5%88%97-%E4%BB%80%E9%BA%BC%E6%98%AFap-map-aaf089920848>Tommy Huang — 深度學習系列: 什麼是AP/mAP?</a></li><li><a href=https://jonathan-hui.medium.com/map-mean-average-precision-for-object-detection-45c121a31173>Jonathan Hui - mAP (mean Average Precision) for Object Detection</a></li></ol></div><div class=article-footer><blockquote class=mt-2x><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>Permalink:</strong>
<a href=https://kaka-lin.github.io/my-blog/2022/08/object_detection/ title="[Object Detection] 目標檢測評估指標 (Object Detection Metrics)" target=_blank rel=external>https://kaka-lin.github.io/my-blog/2022/08/object_detection/</a></li><li class=post-copyright-license><strong>License：</strong><a href=https://creativecommons.org/licenses/by/4.0/deed.zh_TW target=_blank rel=external>CC BY 4.0</a></li></ul></blockquote><div class="panel panel-default panel-badger"><div class=panel-body><figure class=media><div class=media-left><a href=https://github.com/kaka-lin target=_blank class="img-burn thumb-sm visible-lg"><img src=https://kaka-lin.github.io/my-blog/images/kaka_virtual.jpg class="img-rounded w-full" alt></a></div><div class=media-body><h3 class=media-heading><a href=https://github.com/kaka-lin target=_blank><span class=text-dark>Kaka Lin</span><small class=ml-1x>Software Engineer</small></a></h3><div>AIoT</div></div></figure></div></div></div></article><section id=comments><div id=disqus_thread><noscript>Please enable JavaScript to view the <a href=//disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class=bar-inner><ul class="pager pull-left"><li class=prev><a href=https://kaka-lin.github.io/my-blog/2022/08/classification/ title="[Classification] 分類指標 (Classification Metrics)"><i class="icon icon-angle-left" aria-hidden=true></i><span>&nbsp;&nbsp;Older</span></a></li><li class=next><a href=https://kaka-lin.github.io/my-blog/2022/08/tensors/ title="[PyTorch] Tensors (張量)"><span>Newer&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden=true></i></a></li><li class=toggle-toc><a class="toggle-btn collapsed" data-toggle=collapse href=#collapseToc aria-expanded=false title=Catalogue role=button><span>[&nbsp;</span><span>Catalogue</span>
<i class="text-collapsed icon icon-anchor"></i>
<i class="text-in icon icon-close"></i>
<span>]</span></a></li></ul><div class=bar-right></div></div></nav></main><footer class=footer itemscope itemtype=http://schema.org/WPFooter><ul class=social-links><li><a href="https://www.facebook.com/profile.php?id=100001656484042" target=_blank title=facebook data-toggle=tooltip data-placement=top><i class="icon icon-facebook"></i></a></li><li><a href=https://github.com/kaka-lin target=_blank title=github data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li><li><a href=https://www.linkedin.com/in/%E5%AE%B6%E8%B1%AA-%E6%9E%97-014a02116/ target=_blank title=linkedin data-toggle=tooltip data-placement=top><i class="icon icon-linkedin"></i></a></li></ul><div class=copyright>Copyright
&copy;2020 -
2023<div class=publishby>Theme by <a href=https://github.com/xiaoheiAh target=_blank>xiaoheiAh </a>base on<a href=https://github.com/xiaoheiAh/hugo-theme-pure target=_blank> pure</a>.</div></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type=text/x-mathjax-config>
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script><script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js></script>
<script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/python.min.js defer></script>
<script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/javascript.min.js defer></script>
<script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/go.min.js defer></script>
<script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/c.min.js defer></script>
<script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/cpp.min.js defer></script><script>hljs.configure({tabReplace:"    ",classPrefix:""}),hljs.initHighlightingOnLoad()</script>
<script src=https://kaka-lin.github.io/my-blog/js/application.min.e4989ab4dc212027af8773861b05b6bc333a1217f6b0a1b3377a3a3dbd454483.js></script>
<script src=https://kaka-lin.github.io/my-blog/js/plugin.min.738a460bf4317fac61717f1bca393e53d00973db9754d9f0a81c7312d5874840.js></script>
<script>(function(e){var t={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"https://kaka-lin.github.io/my-blog",CONTENT_URL:"https://kaka-lin.github.io/my-blog/searchindex.json "};e.INSIGHT_CONFIG=t})(window)</script><script type=text/javascript src=https://kaka-lin.github.io/my-blog/js/insight.min.716b0c6a00b68ccc31a2b65345f3412f4246ffa94a90f8e25d525528b4504f9937880692bbe619023233caba5d0a17ebe23d7cfb57cd3a88f23ea337ad5e4d00.js defer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js></script>
<script>tocbot.init({tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0})</script><script>var disqus_config=function(){this.page.url="https://kaka-lin.github.io/my-blog/2022/08/object_detection/",this.page.identifier="kaka-blog"};(function(){var e=document,t=e.createElement("script");t.src="//kaka-blog.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script></body></html>